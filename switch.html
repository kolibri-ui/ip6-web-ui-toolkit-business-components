<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Switch Component</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <link rel=stylesheet type="text/css" href="assets/kolibri/kolibri.css"/>
</head>
<body data-theme="light">

<h1 class="special-header">
    Switch Component
</h1>

<div class="switch-div-frame  login">
    <h1>3-State Switch</h1>
    <label class="switch three-state">
        <input type="checkbox" id="three-state" data-type="switch" data-threestate="true">
        <span class="thumb">
            <span class="arrow arrow-left" id="arrow-right-three-state"></span>
            <span class="arrow arrow-right" id="arrow-left-three-state"></span>

            <span class="arrow arrow-indeterminate-left" id="arrow-indeterminate-left-three-state"></span>
            <span class="arrow arrow-indeterminate-right" id="arrow-indeterminate-right-three-state"></span>

        </span>
        <img alt="off" class="switch-icon off" id="three-state-off" src="assets/kolibri/icons/cross.svg"
             draggable="false">
        <img alt="indeterminate" class="switch-icon indeterminate" id="three-state-indeterminate"
             src="assets/kolibri/icons/dot.svg" draggable="false">
        <img alt="on" class="switch-icon on" id="three-state-on" src="assets/kolibri/icons/checkmark.svg"
             draggable="false">
    </label>
    <br>
    <div>
        <h4> States</h4>
        <label for="disable-three-state">
            <input type="checkbox" class="disabled" id="disable-three-state"> Disabled</label><br/>
        <label for="readonly-three-state">
            <input type="checkbox" class="readonly" id="readonly-three-state"> Read-Only</label><br/>
        <label for="required-three-state">
            <input type="checkbox" class="required" id="required-three-state"> Required</label><br/>
    </div>
</div>


<div class="switch-div-frame">
    <h1>2-State Switch</h1>
    <label class="switch">
        <input type="checkbox" id="two-state" data-type="switch">
        <span class="thumb">
            <span class="arrow arrow-left" id="arrow-right-two-state"></span>
            <span class="arrow arrow-right" id="arrow-left-two-state"></span>
        </span>
        <img alt="off" class="switch-icon off" id="two-state-off" src="assets/kolibri/icons/cross.svg"
             draggable="false">
        <img alt="on" class="switch-icon on" id="two-state-on" src="assets/kolibri/icons/checkmark.svg"
             draggable="false">
    </label>

    <div>
        <h4> States</h4>
        <label for="disable-two-state">
            <input type="checkbox" id="disable-two-state"> Disabled</label><br/>
        <label for="readonly-two-state">
            <input type="checkbox" id="readonly-two-state"> Read-Only</label><br/>
    </div>
</div>

<label for="featureToggle" class="featureToggle">
    <input type="checkbox" id="featureToggle"> Dark Mode Toggle
</label>
<!--
<div class="switch-div-frame">
    <h1>Colors</h1>
    <div>
        <ul class="color-ul">
            <li>
                <label for="switchColor">Thumb Color</label>
                <input type="color" id="switchColor" name="switchColor" value="#184BCD">
            </li>
            <li>
                <label for="switchColorBG">Background Color</label><br/>
                <input type="color" id="switchColorBG" name="switchColorBG" value="#bdbdbd">
            </li>
            <li>
                <label for="switchColorIcons">IconsColor</label><br/>
                <input type="color" id="switchColorIcons" name="switchColorIcons" value="#14142B">
            </li>
        </ul>
    </div>
</div>-->

<script>
    const body = document.getElementsByTagName("body");
    const threeState = document.getElementById("three-state");
    const threeStateOuter = threeState.parentNode;
    const threeStateIndeterminate = document.getElementById("three-state-indeterminate");
    const threeStateOff = document.getElementById("three-state-off");
    const threeStateOn = document.getElementById("three-state-on");

    const disableThreeState = document.getElementById("disable-three-state");
    const readOnlyThreeState = document.getElementById("readonly-three-state");
    const requiredThreeState = document.getElementById("required-three-state");


    const twoState = document.getElementById("two-state");
    const twoStateOuter = twoState.parentNode;
    const disableTwoState = document.getElementById("disable-two-state");
    const readOnlyTwoState = document.getElementById("readonly-two-state");
    const twoStateOn = document.getElementById("two-state-on");
    const twoStateOff = document.getElementById("two-state-off");


    const arrowLeftThreeState = document.getElementById("arrow-left-three-state");
    const arrowRightThreeState = document.getElementById("arrow-right-three-state");

    const arrowIndeterminateLeftThreeState = document.getElementById("arrow-indeterminate-left-three-state");
    const arrowIndeterminateRightThreeState = document.getElementById("arrow-indeterminate-right-three-state");

    const arrowLeftTwoState = document.getElementById("arrow-left-two-state");
    const arrowRightTwoState = document.getElementById("arrow-right-two-state");


    twoState.onclick = e => e.preventDefault();
    threeState.onclick = e => e.preventDefault();

    threeStateIndeterminate.onclick = _ => threeState.indeterminate = true;

    threeStateOff.onclick = _ => {
        threeStateOuter.classList.remove("required");
        requiredThreeState.checked = false;
        threeState.indeterminate = false;
        threeState.checked = false;
    }

    threeStateOn.onclick = _ => {
        threeStateOuter.classList.remove("required");
        threeState.indeterminate = false;
        requiredThreeState.checked = false;
        threeState.checked = true;
    }

    disableThreeState.onchange = e => {
        threeState.disabled = e.target.checked;
        if (e.target.checked) {
            threeStateOuter.classList.add("disabled");
        } else {
            threeStateOuter.classList.remove("disabled");
        }
    }

    readOnlyThreeState.onchange = e => {
        threeState.readOnly = e.target.checked;
        if (e.target.checked) {
            threeStateOuter.classList.add("read-only");
        } else {
            threeStateOuter.classList.remove("read-only");
        }
    }

    requiredThreeState.onchange = e => {
        threeState.required = e.target.checked;
        threeState.indeterminate = true;
        if (e.target.checked) {
            threeStateOuter.classList.add("required");
        } else {
            threeStateOuter.classList.remove("required");
        }
    }

    threeStateOuter.onmouseover = () => {
        threeStateOuter.classList.remove("required");
        requiredThreeState.checked = false;

        if (!threeState.disabled && !threeState.readOnly) {
            if (threeState.checked) {
                arrowLeftThreeState.style.display = 'none';
                arrowRightThreeState.style.display = 'block';
            } else {
                arrowRightThreeState.style.display = 'none';
                arrowLeftThreeState.style.display = 'block';
            }

            if (threeState.indeterminate) {
                arrowRightThreeState.style.display = 'none';
                arrowLeftThreeState.style.display = 'none';
                arrowIndeterminateLeftThreeState.style.display = 'block';
                arrowIndeterminateRightThreeState.style.display = 'block';

            }
        }
    }

    threeStateOuter.onmouseout = () => {
        arrowRightThreeState.style.display = 'none';
        arrowLeftThreeState.style.display = 'none';
        arrowIndeterminateLeftThreeState.style.display = 'none';
        arrowIndeterminateRightThreeState.style.display = 'none';
    }


    threeState.onfocus = e => {
        threeStateOuter.classList.remove("required");
        threeStateOuter.classList.add("focus");
        threeStateOuter.focus();
    }

    threeState.onblur = e => {
        threeStateOuter.classList.remove("focus");
        threeStateOuter.blur();
    }


    /**
     * Two State
     */

    const switchTheme = state => {

        const featureToggle = document.getElementById("featureToggle");

        if (featureToggle.checked) {
            if (state) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark'); //add this
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light'); //add this
            }
        }
    }


    twoStateOn.onclick = _ => {
        twoState.checked = true;
        switchTheme(twoState.checked);
    }
    twoStateOff.onclick = _ => {
        twoStateOuter.classList.add("focus");
        twoStateOuter.focus();
        twoState.checked = false;
        switchTheme(twoState.checked);
    }

    disableTwoState.onchange = e => {
        twoState.disabled = e.target.checked;
        if (e.target.checked) {
            twoStateOuter.classList.add("disabled");
        } else {
            twoStateOuter.classList.remove("disabled");
        }
    }

    readOnlyTwoState.onchange = e => {
        twoState.readOnly = e.target.checked;
        if (e.target.checked) {
            twoStateOuter.classList.add("read-only");
        } else {
            twoStateOuter.classList.remove("read-only");
        }
    }


    twoState.onfocus = _ => {
        twoStateOuter.classList.add("focus");
        twoStateOuter.focus();
    }

    twoState.onblur = _ => {
        twoStateOuter.classList.remove("focus");
        twoStateOuter.blur();
    }


    twoStateOuter.onmouseout = () => {
        arrowLeftTwoState.style.display = 'none';
        arrowRightTwoState.style.display = 'none';
    }

    twoStateOuter.onmouseover = () => {
        if (!twoState.disabled && !twoState.readOnly) {
            if (twoState.checked) {
                arrowLeftTwoState.style.display = 'none';
                arrowRightTwoState.style.display = 'block';
            } else {
                arrowRightTwoState.style.display = 'none';
                arrowLeftTwoState.style.display = 'block';
            }
        }
    }

    let mousePos = 0;
    let mouseOffset = 20;

    threeStateOuter.onmousedown = e => mousePos = e.x;
    threeStateOuter.onmouseup = (e) => {
        let cmove = calcMovement(e.x);
        threeState.setAttribute('checked', cmove.toString());
        threeState.checked = cmove;
        switchTheme(cmove);
    }

    twoStateOuter.onmousedown = e => mousePos = e.x;
    twoStateOuter.onmouseup = (e) => {
        let cmove = calcMovement(e.x);
        twoState.setAttribute('checked', cmove.toString());
        twoState.checked = cmove;
        switchTheme(cmove);
    };

    const calcMovement = (ex) => {
        if (mousePos > ex + mouseOffset) {
            return false;
        } else if (mousePos < ex) {
            return true;
        }
    }


    //Keyboard Control
    document.onkeydown = (e) => {
        if (document.activeElement.dataset.type === "switch") {

            if (e.key === "ArrowRight") {
                document.activeElement.indeterminate = false;
                document.activeElement.checked = true;
            } else if (e.key === "ArrowLeft") {
                document.activeElement.indeterminate = false;
                document.activeElement.checked = false;
            }
            if (e.key === "Delete") {
                if (document.activeElement.dataset.threestate === "true") {
                    document.activeElement.indeterminate = true;
                }
            }
        }
    };


</script>
</body>
</html>
